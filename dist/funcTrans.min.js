!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).FT={})}(this,(function(t){"use strict";const n=/^(\(|[-+]|(\d*\.\d+)|(\d+\.\d*)|\d+|[*\/]|\)|\^\||\$\||\^|(ln|lg|log)|(cos|sin|tan|cot)|x|\|)/,s=/^[+-]+\d+$/,e=/^\d+$/,r=/((^\d*\.\d+$)|(^\d+\.\d*$))/,i=/((^([+-]+)?\d*\.\d+$)|(^([+-]+)?\d+\.\d*$))/,o=/^\($/,u=/^\)$/,f=/^\^\|$/,l=/^\$\|$/,a=function(t,n){let s=n.shift(),e=`Math.log(${Array.isArray(s)?A(s):s})`;t.push(e)},h=function(t,n,s){let e=n.shift(),r=`Math.${s}(${Array.isArray(e)?A(e):e})`;t.push(r)},c={"^":function(t,n){let s=t.pop(),e=n.shift(),r=`Math.pow(${Array.isArray(s)?A(s):s},${Array.isArray(e)?A(e):e})`;t.push(r)},ln:a,log:a,lg:function(t,n){let s=n.shift(),e=`Math.log(${Array.isArray(s)?A(s):s})/Math.log(10)`;t.push(e)},sin:h,cos:h,tan:h,cot:function(t,n){let s=n.shift();s=Array.isArray(s)?A(s):s;let e=`Math.cos(${s})/Math.sin(${s})`;t.push(e)},abs:function(t){return t.unshift("Math.abs("),t.push(")"),t}},$={x:function(t,n){let s=t.results;n>0&&(g(s[n-1])||(e=s[n-1],u.test(e))||function(t){return l.test(t)}(s[n-1]))&&(s[n]=`*${s[n]}`);var e;n<s.length-1&&(g(s[n+1])||function(t){return o.test(t)}(s[n+1])||function(t){return f.test(t)}(s[n+1]))&&(s[n]=`${s[n]}*`)},"(":function(t,n){let s=t.results;n>0&&g(s[n-1])&&(s[n-1]=`${s[n-1]}*`)},")":function(t,n){let s=t.results;n>0&&g(s[n+1])&&(s[n+1]=`*${s[n+1]}`)},ln:p,lg:p,log:p,sin:d,cos:d,tan:d,cot:d,"|":function(t,n){let s=t.results;t._absCount?(s[n]="^"+s[n],t._absCount--):(s[n]="$"+s[n],t.$absCount--)}};function p(t,n){let s=t.results;n>0&&g(s[n-1])&&(s[n-1]=`${s[n-1]}*`)}function d(t,n){let s=t.results;n>0&&g(s[n-1])&&(s[n-1]=`${s[n-1]}*`)}function g(t){return s.test(t)||e.test(t)||r.test(t)||i.test(t)}function y(t,n){if(!t&&n)throw"illegal expression"}function b(t){let s={results:[],_absCount:0,$absCount:0},e=!1,r=0;for(;t;)e=!1,t=t.replace(n,((t,n)=>(e=!0,"|"===t&&r++,s.results.push(t),""))),y(e,t);return function(t,n){!function(t){if(t%2!=0)throw"abs must come with partners"}(n),t._absCount=t.$absCount=n/2}(s,r),function(t){let n=[],s=t.shift();const e={"(":function(){let e="";s=t.shift();let r=1,i=0;for(;s&&("("===s&&r++,")"===s&&i++,r!==i);)e+=s,s=t.shift();if(r!==i)throw"leftParentheses and leftParentheses are mismatching";n.push(b(e))},"^|":function(){let e="";s=t.shift();let r=1,i=0;for(;s&&("^|"===s&&r++,"$|"===s&&i++,i!==r);)e+=s,s=t.shift();if(r!==i)throw"leftAbsSign and rightAbsSign are mismatching";n.push(c.abs(b(e)))}};for(;s;)e[s]?e[s]():n.push(s),s=t.shift();return n}(function(t){let n=t.results;for(let s=0;s<n.length;s++){let e=n[s];$[e]&&$[e](t,s)}return n}(s))}function A(t){let n=[],s=t.shift();for(;s;)Array.isArray(s)?(n.push(A(s)),s=t.shift()):(c[s]?c[s](n,t,s):n.push(s),s=t.shift());return function(t){return t.unshift("("),t.push(")"),t.join("")}(n)}t.expressionGenerator=A,t.expressionParser=function(t){return A(b(t))},Object.defineProperty(t,"__esModule",{value:!0})}));
